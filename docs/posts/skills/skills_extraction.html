<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Sean Greaves">
<meta name="dcterms.date" content="2023-08-10">
<meta name="description" content="Prompt design and fine-tuning models with Hugging Face and OpenAI">

<title>ADU blog - Skills Extraction with Large Language Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-CNN34L2RWE"></script>

<script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-CNN34L2RWE', { 'anonymize_ip': true});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"express",
  "palette":"dark",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  });
});
</script> 
  
<!-- Make the 'ADU' in 'the ADU blog' stand out -->
<script>
    document.addEventListener("DOMContentLoaded", function(event) { 
        //document.getElementsByClassName('navbar-title')[0].innerHTML = "the <span id=adu>ADU</span> blog"
        //document.getElementsByClassName('navbar-title')[0].innerHTML = "<span id=adu>A</span>utonomy <span id=adu>D</span>ata <span id=adu>U</span>nit"
        document.getElementsByClassName('navbar-title')[0].innerHTML = "<span id=adu>Autonomy Data Unit</span>"
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="ADU blog - Skills Extraction with Large Language Models">
<meta property="og:description" content="Prompt design and fine-tuning models with Hugging Face and OpenAI">
<meta property="og:image" content="https://data.autonomy.work/posts/skills/assets/linkedin.png">
<meta property="og:site-name" content="ADU blog">
<meta property="og:image:height" content="802">
<meta property="og:image:width" content="1791">
<meta name="twitter:title" content="ADU blog - Skills Extraction with Large Language Models">
<meta name="twitter:description" content="Prompt design and fine-tuning models with Hugging Face and OpenAI">
<meta name="twitter:image" content="https://data.autonomy.work/posts/skills/assets/linkedin.png">
<meta name="twitter:image-height" content="802">
<meta name="twitter:image-width" content="1791">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../autonomy_logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">ADU blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">about</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://autonomy.work/adu/" rel="" target="_blank"><i class="bi bi-window" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Autonomy-Data-Unit" rel="" target="_blank"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/Autonomy_UK" rel="" target="_blank"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.instagram.com/autonomy.uk/" rel="" target="_blank"><i class="bi bi-instagram" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Skills Extraction with Large Language Models</h1>
                  <div>
        <div class="description">
          Prompt design and fine-tuning models with Hugging Face and OpenAI
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">analysis</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Sean Greaves </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 10, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p><img src="assets/linkedin.png" class="img-fluid"></p>
<p>Skills extraction is a well explored task in natural language processing often applied to job ads and employment data to quantify the supply and demand of skills within a population. Skills extraction can help authorities aquire rich localised labour market data to inform policy. Such data can play an important role in planning for transitions such as ensuring the UK has the neccessary skills in place to retrofit the nation’s housing stock to meet net-zero targets. Having the right composition of skills can mitigate the negative impacts of skills mismatches which can occur in both a surplus of skills, such as too many university graduates looking for high-quality roles, as well as shortages in skills like the supposed <a href="https://www.ft.com/content/b1b710a1-6d12-43e5-8508-ae4584a7289a">dearth of UK tech talent in 2023</a>.</p>
<p>In this post we will test drive some recent approaches to skills extraction using large language models. We prioritise approaches that are accessible, relatively low cost and can be tested fairly quickly. We are motivated by existing work applying LLMs to skills extraction such as <a href="https://data-viz.nesta.org.uk/skills-taxonomy/index.html">Nesta’s taxonomies of UK skills</a>.</p>
<div class="cell">
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"ef02e34646944b95b1d7c118ee301a96","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"3e21fedcca6d48a08ef7710c2c26786d","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"7172ef1947a648acb05ed600b2c8b1e2","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<section id="token-classification" class="level2">
<h2 class="anchored" data-anchor-id="token-classification">1. Token Classification</h2>
<p>Skills extraction can be approached as a named entity recognition task where we train models to label sequences of words that correspond to skills. This approach does require quality labelled datasets that can be time-consuming to build and difficult to source. The highest quality open dataset with skill annotations that we could get our hands on is <a href="https://github.com/kris927b/SkillSpan">‘Skillspan’</a> from Zhang et al.&nbsp;(2022) consisting of 265 annotated English language job profiles (14.5K sentences and over 12.5K annotated spans) for hard and soft skills. This excellent resource is released alongside a codebase and paper <a href="https://arxiv.org/abs/2204.12811">‘SkillSpan: Hard and Soft Skill Extraction from Job Postings’</a> in which the researchers report performance benchmarks for several transformer models fine-tuned on SkillSpan. Furthermore, the paper includes the extensive annotation guidelines used by the researchers to label the SkillSpan dataset, giving an insight into how time-consuming this task most likely was.</p>
<p>The data in SkillSpan is seperated into sentences labelled in the CoNNL format which looks like this:</p>
<table class="table">
<thead>
<tr class="header">
<th>Word</th>
<th>Skill</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>The</td>
<td>O</td>
</tr>
<tr class="even">
<td>candidate</td>
<td>O</td>
</tr>
<tr class="odd">
<td>should</td>
<td>O</td>
</tr>
<tr class="even">
<td>be</td>
<td>O</td>
</tr>
<tr class="odd">
<td>competant</td>
<td>O</td>
</tr>
<tr class="even">
<td>programming</td>
<td>B-Skill</td>
</tr>
<tr class="odd">
<td>in</td>
<td>I-Skill</td>
</tr>
<tr class="even">
<td>Python</td>
<td>I-Skill</td>
</tr>
<tr class="odd">
<td>,</td>
<td>O</td>
</tr>
<tr class="even">
<td>mentoring</td>
<td>B-Skill</td>
</tr>
<tr class="odd">
<td>junior</td>
<td>I-Skill</td>
</tr>
<tr class="even">
<td>collegues</td>
<td>I-Skill</td>
</tr>
<tr class="odd">
<td>and</td>
<td>O</td>
</tr>
<tr class="even">
<td>presenting</td>
<td>B-Skill</td>
</tr>
<tr class="odd">
<td>to</td>
<td>I-Skill</td>
</tr>
<tr class="even">
<td>leadership</td>
<td>I-Skill</td>
</tr>
</tbody>
</table>
<p>Words are labelled ‘O’ if they are not part of a skill. The first word in a skill sequence is labelled <code>B-Skill</code> (b for beginning) and all proceeding words labelled <code>I-Skill</code>.</p>
<p>When shopping for model architectures that might yield the best performance when fine-tuned on SkillSpan, we could look to roughly comparable datasets such as CoNLL 2003 and recent performance benchmarks. Models building on the BERT/RoBERTa architectures <a href="https://paperswithcode.com/sota/token-classification-on-conll2003">seem to do particularly well</a> at entity recognition. This is because they are designed for bidirectional context understanding; understanding a word or phrase in the context of all the other words and phrases that surround it in a sentence. This is different to models like GPT-3/GPT-4 which are designed for unidirectional context understanding (left-to-right) which makes them excellent at generating human-like text but less effective at entity extraction out-the-box. We will attempt to benchmark SkillSpan on BERT and RoBERTa to see how feasible it is to fine-tune excellent skill extractors on consumer hardware with open data.</p>
<section id="training-and-testing" class="level3">
<h3 class="anchored" data-anchor-id="training-and-testing">Training and Testing</h3>
<p>We attempt to fine-tune BERT and RoBERTa on part of the SkillSpan dataset and compare performance with <a href="https://huggingface.co/jjzha/jobbert_skill_extraction">‘JobBert’</a>, a model released by the SkillSpan researchers pre-trained on 3.2M unlabeled job profile sentences. We fine-tuned our models on a V100 GPU (P3.2xlarge AWS EC2 instance) using a basic <a href="https://github.com/Autonomy-Data-Unit/llm-skills-extraction">NBDev workflow</a>. To access performance of the models, we <a href="https://github.com/Autonomy-Data-Unit/llm-skills-extraction/blob/main/nbs/run/run_04_evaluate.ipynb">evaluate them on the two open SkillSpan test sets</a> known as HOUSE and TECH (comprised of job profiles from StackOverflow):</p>
<table class="table">
<colgroup>
<col style="width: 10%">
<col style="width: 13%">
<col style="width: 11%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 10%">
<col style="width: 7%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th>Model/Dataset</th>
<th>Precision (HOUSE)</th>
<th>Recall (HOUSE)</th>
<th>F1 (HOUSE)</th>
<th>Accuracy (HOUSE)</th>
<th>Precision (TECH)</th>
<th>Recall (TECH)</th>
<th>F1 (TECH)</th>
<th>Accuracy (TECH)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>BERT</td>
<td>46.26</td>
<td>45.90</td>
<td>46.08</td>
<td>93.50</td>
<td>48.41</td>
<td>53.17</td>
<td>50.68</td>
<td>94.91</td>
</tr>
<tr class="even">
<td>RoBERTa</td>
<td>55.94</td>
<td>49.05</td>
<td>52.27</td>
<td>93.84</td>
<td>57.98</td>
<td>54.04</td>
<td>55.94</td>
<td>95.24</td>
</tr>
<tr class="odd">
<td>JobBERT</td>
<td>52.22</td>
<td>53.79</td>
<td>52.99</td>
<td>94.45</td>
<td>50.22</td>
<td>50.33</td>
<td>50.27</td>
<td>94.96</td>
</tr>
</tbody>
</table>
<p>We notice a clear difference in performance between the subsets with RoBERTa outperforming on TECH and RoBERTa/JobBert performing better than BERT on HOUSE. RoBERTa achieves higher precision on both sets; getting a greater proportion of it’s labels correct. RoBERTa’s optimizations relative to JobBERT/BERT include training on a larger corpus of text and the use of dynamic masking which may have contributed to tangible improvements over the original BERT architectures. Differences in performance between JobBERT and BERT may be due to JobBERT being trained on a more relevant dataset of job profiles and fine-tuned on the full SkillSpan dataset compared to the 2 open-source subsets of SkillSpan our models were fine-tuned on.</p>
<p>To get a sense of how these models perform on job ads we might scrape from the internet in the future, we can test them on an example. Lets check out an <a href="https://web.archive.org/web/20230806033102/https://jobs.lever.co/Anthropic/e3cde481-d446-460f-b576-93cab67bd1ed">ad for an SF-based role in the emerging economically lucractive discipline of so-called prompt engineering</a>:</p>
<p><img src="assets/anthropic.png" class="img-fluid"></p>
<p>We can easily load our trained models from the Hugging Face Hub and test them on the full job profile by feeding each sentence to the model individually (similar to how the model was trained). We then print all the sentences where words were labelled. RoBERTa generated the following labels:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> transformers <span class="im">import</span> pipeline</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>token_classifier <span class="op">=</span> pipeline(</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"token-classification"</span>, model<span class="op">=</span><span class="st">"autosyrup/roberta"</span>, tokenizer<span class="op">=</span><span class="st">"autosyrup/roberta"</span>,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    ignore_labels<span class="op">=</span>[<span class="st">'O'</span>]</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">You will figure out the best methods of prompting our AI to accomplish a wide range of tasks, then document these methods to build up a library of tools and a set of tutorials that allows others to learn prompt engineering, as well as <span style="background-color: #C99E39;">work with high value partners</span> to directly solve their challenges.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">Responsibilities: <span style="background-color: #C99E39;">Discover, test, and document best practices</span> for a wide range of tasks relevant to our customers.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;"><span style="background-color: #C99E39;">Build up a library of high quality prompts or prompt chains</span> to accomplish a variety of tasks, with an easy guide to help users search for the one that meets their needs.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;"><span style="background-color: #C99E39;">Build a set of tutorials and interactive tools</span> that teach the art of prompt engineering to our customers.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;"><span style="background-color: #C99E39;">Work with large enterprise customers</span> on their prompting strategies.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">Are an excellent <span style="background-color: #C99E39;">communicator</span>, and love <span style="background-color: #C99E39;">teaching technical concepts</span> and <span style="background-color: #C99E39;">creating high quality documentation</span> that helps out others.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">Are excited to <span style="background-color: #C99E39;">talk to motivated customers</span> and help solve their problems.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">Have a <span style="background-color: #C99E39;">creative hacker spirit</span> and love <span style="background-color: #C99E39;">solving puzzles</span>.<br></div>
</div>
<div class="cell-output cell-output-display">

<div style="background-color: #333333; color: #FFFFFF;">Have at least basic <span style="background-color: #C99E39;">programming</span> skills and would be comfortable <span style="background-color: #C99E39;">writing small Python programs</span>.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">Have an <span style="background-color: #C99E39;">organizational mindset</span> and enjoy <span style="background-color: #C99E39;">building teams from the ground up</span>.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">You <span style="background-color: #C99E39;">think holistically</span> and can <span style="background-color: #C99E39;">proactively identify the needs of an organization</span>.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;"><span style="background-color: #C99E39;">Make ambiguous problems clear</span> and <span style="background-color: #C99E39;">identify core principles</span> that can translate across scenarios.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">You <span style="background-color: #C99E39;">anticipate unforeseen risks</span>, <span style="background-color: #C99E39;">model out scenarios</span>, and <span style="background-color: #C99E39;">provide actionable guidance</span> to internal stakeholders.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;"><span style="background-color: #C99E39;">Think creatively about the risks and benefits of new</span> technologies, and think beyond past checklists and playbooks.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">You stay up-to-date and informed by <span style="background-color: #C99E39;">taking an active interest in emerging research and industry trends</span>.<br></div>
</div>
</div>
<p>We can see RoBERTa has identified 24 skills in 15/59 sentences that make up the job ad. The results seem sensible and cover almost all of the skills we might identify in the <a href="https://web.archive.org/web/20230806033102/https://jobs.lever.co/Anthropic/e3cde481-d446-460f-b576-93cab67bd1ed">original ad</a>. We can test the similarly capable JobBERT model to see how it compares with RoBERTa:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>token_classifier <span class="op">=</span> pipeline(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"token-classification"</span>, model<span class="op">=</span><span class="st">"jjzha/jobbert_skill_extraction"</span>, tokenizer<span class="op">=</span><span class="st">"jjzha/jobbert_skill_extraction"</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    ignore_labels<span class="op">=</span>[<span class="st">'O'</span>]</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">You will <span style="background-color: #C99E39;">figure out the best methods of prompting our AI</span> to <span style="background-color: #C99E39;">accomplish a wide range of tasks</span>, then document these methods to <span style="background-color: #C99E39;">build</span> up a library of tools and a set of tutorials that allows others to learn prompt engineering, as well as <span style="background-color: #C99E39;">work with high value partners</span> to directly solve their challenges.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">Responsibilities: <span style="background-color: #C99E39;">Discover, test, and document best practices for a wide range of tasks</span> relevant to our customers.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;"><span style="background-color: #C99E39;">Build up a library of high quality prompts or prompt chains</span> to <span style="background-color: #C99E39;">accomplish a variety of tasks</span>, with an easy guide to help users search for the one that meets their needs.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;"><span style="background-color: #C99E39;">Build a set of tutorials and interactive tools</span> that teach the art of prompt engineering to our customers.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;"><span style="background-color: #C99E39;">Work with large enterprise customers</span> on their prompting strategies.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">Are an excellent <span style="background-color: #C99E39;">communicator</span>, and love <span style="background-color: #C99E39;">teaching technical concepts</span> and <span style="background-color: #C99E39;">creating high quality documentation</span> that <span style="background-color: #C99E39;">helps out others</span>.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">Are excited to <span style="background-color: #C99E39;">talk to motivated customers</span> and help solve their problems.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">Have a <span style="background-color: #C99E39;">creative hacker spirit</span> and love <span style="background-color: #C99E39;">solving puzzles</span>.<br></div>
</div>
<div class="cell-output cell-output-display">

<div style="background-color: #333333; color: #FFFFFF;">Have at least basic <span style="background-color: #C99E39;">programming</span> skills and would be comfortable <span style="background-color: #C99E39;">writing small Python programs</span>.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">Have an <span style="background-color: #C99E39;">organizational mindset</span> and enjoy <span style="background-color: #C99E39;">building teams from the ground up</span>.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">You <span style="background-color: #C99E39;">think holistically</span> and can <span style="background-color: #C99E39;">proactively identify the needs of an organization</span>.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;"><span style="background-color: #C99E39;">Make ambiguous problems clear</span> and <span style="background-color: #C99E39;">identify core principles</span> that can translate across scenarios.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">You <span style="background-color: #C99E39;">anticipate unforeseen risks</span>, <span style="background-color: #C99E39;">model out scenarios</span>, and <span style="background-color: #C99E39;">provide actionable guidance</span> to internal stakeholders.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;"><span style="background-color: #C99E39;">Think creatively about the risks and benefits of new technologies</span>, and think beyond past checklists and playbooks.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">As such, we greatly value <span style="background-color: #C99E39;">communication</span> skills.<br></div>
</div>
</div>
<p>Both models label the same 14 sentences out of the 59 that make up the job profile, only differing on several labels. If we include BERT’s inference results, there are at least 26 common spans labelled by 2 of the 3 models:</p>
<div class="cell">
<div class="cell-output cell-output-display">
<pre><code>{'Build a set of tutorials and interactive tools',
 'Build up a library of high quality prompts or prompt chains',
 'Discover, test, and document best practices',
 'Make ambiguous problems clear',
 'Think creatively about the risks and benefits of new technologies',
 'Work with large enterprise customers',
 'accomplish a variety of tasks',
 'anticipate unforeseen risks',
 'building teams from the ground up',
 'communicator',
 'creating high quality documentation',
 'creative hacker spirit',
 'helps out others',
 'identify core principles',
 'model out scenarios',
 'organizational mindset',
 'proactively identify the needs of an organization',
 'programming',
 'provide actionable guidance',
 'solving puzzles',
 'taking an active interest in emerging research and industry trends',
 'talk to motivated customers',
 'teaching technical concepts',
 'think holistically',
 'work with high value partners',
 'writing small Python programs'}</code></pre>
</div>
</div>
<p>This list of commonly labelled spans suggests it can be advantageous aggregating the inference results from multiple models in a pipeline to filter out some of the lower quality labels (in this case labels like <code>build</code> or the unfinished <code>Think creatively about the risks and benefits of new</code>).</p>
<p>Whilst auto-encoding transformer models like BERT are theoretically best suited for skills extraction, lets now explore how we can fine-tune and prompt auto-regressive models like GPT-3/GPT-4 into labelling skills.</p>
</section>
<section id="fine-tuning-gpt-3" class="level3">
<h3 class="anchored" data-anchor-id="fine-tuning-gpt-3">2. Fine-tuning GPT-3</h3>
<p>At present their are two approaches to guiding OpenAI’s LLMs towards a user-defined task: prompt design and fine-tuning. Prompt design is more accessible; it doesn’t neccesarily require a dataset, data preprocessing or interaction via API. Fine-tuning however can lead to potentially higher quality results and allows us to save costs on inference by removing the need to repeatedly waste tokens explaining the task or desired output format to a model via elaborate or sprawling prompts. Fine-tuning is also pretty straightforward and not very expensive as we will demonstrate.</p>
<p>Compared to the fine-tuning we previously conducted with BERT, fine-tuning GPT-3 is easier. We don’t need to specify the task, select the best model architecture (other than which version of GPT-3 to fine-tune: <code>davinci</code>, <code>ada</code>, <code>babbage</code> or <code>curie</code>) or install anything (other than the <code>openai</code> python package). We just need to provide a dataset and optional hyper-parameters via the OpenAI API. Through few shot learning LLMs can infer the task we are training them for, which in the case of entity extraction is similar to language transformation tasks.</p>
<p>To prepare our dataset for fine-tuning OpenAI recommends we build a <code>.jsonl</code> file with each line containing a sentence from SkillSpan with the sentence as the value for ‘prompt’ and the labels (seperated with line break characters <code>\n</code>) as the values for ‘completion’ like so:</p>
<pre><code>{
    "prompt": "You will be doing this by finding the right partners and building a program to acquire new customers for these markets Develop global partnerships with leading European and South African wineries\n\n###\n\n",
    "completion": " finding the right partners\nbuilding a program\naquire new partners\nDevelop global partnerships END"
}</code></pre>
<p>We adapt SkillSpan to <code>.jsonl</code> and train Davinci (the most pricey model) on the dataset. Fine-tuning with SkillSpan cost $20 and took just less than 1 hour:</p>
<p><img src="assets/finetune.png" class="img-fluid"></p>
<p>Once the model is trained, we could easily test on an example sentence, such as <code>Ability to debug issues in a full stack environment</code>, making sure to include some of the formatting quirks OpenAI recommended we included in the training data (like starting prompts with whitespace and ending with <code>\n\n####\n\n</code>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>openai.Completion.create(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"davinci:ft-autonomy-2023-08-04-19-06-39"</span>,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    prompt<span class="op">=</span><span class="st">" Ability to debug issues in a full stack environment</span><span class="ch">\n\n</span><span class="st">###</span><span class="ch">\n\n</span><span class="st">"</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    stop<span class="op">=</span>[<span class="st">" END"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;OpenAIObject text_completion id=cmpl-7m5StSLE9WRXTxwUCYllioHchjREs&gt; JSON: {
  "id": "cmpl-7m5StSLE9WRXTxwUCYllioHchjREs",
  "object": "text_completion",
  "created": 1691695107,
  "model": "davinci:ft-autonomy-2023-08-04-19-06-39",
  "choices": [
    {
      "text": " debug issues in a full stack environment",
      "index": 0,
      "logprobs": null,
      "finish_reason": "stop"
    }
  ],
  "usage": {
    "prompt_tokens": 13,
    "completion_tokens": 7,
    "total_tokens": 20
  }
}</code></pre>
</div>
</div>
<p>In our testing, fine-tuned GPT-3 correctly labelled <code>debug issues in a full stack environment</code>.</p>
<p>Despite the model labelling this result correctly, it is still vulnerable to returning text that doesn’t match any substrings within the input sentence. GPT-3 is not deterministic (like BERT) so we could in theory get a different result each time. The fine-tuned model can return results containing capital letters, punctuation and even words that didn’t occur in the input sentence- in other words partially hallucinated skills. We notice this can happen more frequently when setting the optional temperature parameter higher (values between 0.0 and 2.0), which corresponds with the model attempting to be more ‘creative’ in its output at the expense of being deterministic and focussed.</p>
<p>We apply post-processing steps on the output text, converting it to a list of labels and then attempting to find the index range in the original sentence where the label occurs. For instances where an exact match cannot be found we use an implementation of the Ratcliff/Obershelp algorithm to perform fuzzy matching. By matching GPT-3’s labels with the original sentences we can actually score the Davinci model using <code>seqeval</code>. We report the following metrics:</p>
<table class="table">
<colgroup>
<col style="width: 13%">
<col style="width: 16%">
<col style="width: 14%">
<col style="width: 10%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th>Model/Dataset</th>
<th>Precision (HOUSE)</th>
<th>Recall (HOUSE)</th>
<th>F1 (HOUSE)</th>
<th>Precision (TECH)</th>
<th>Recall (TECH)</th>
<th>F1 (TECH)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Davinci (GPT-3)</td>
<td>46</td>
<td>34</td>
<td>39</td>
<td>48</td>
<td>40</td>
<td>44</td>
</tr>
</tbody>
</table>
<p>It is surprising and impressive to see GPT-3 is able to perform this task with any competancy, achieving similar precision to BERT, given that the model is inferring the task entirely from the dataset and is approaching token classification as sequence prediction.</p>
<p>If we test fine-tuned GPT-3 on the original ‘Prompt Engineer’ job posting we notice the model does identify some of the same labels as the BERT models but also misses a number of key skills and labels incompletely (<code>active</code>, <code>provide</code>, <code>accomplish a</code> and <code>build up</code> are some of the more lacklustre labels):</p>
<div class="cell">
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">However, large language models are a new type of intelligence, and the art of <span style="background-color: #C99E39;">instructing</span> them in a way that delivers the best results is still in its infancy — it’s a hybrid between <span style="background-color: #C99E39;">programming</span>, instructing, and <span style="background-color: #C99E39;">teaching</span>.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">You will <span style="background-color: #C99E39;">figure out the best methods of prompting our AI</span> to accomplish a wide range of tasks, then <span style="background-color: #C99E39;">document these methods</span> to <span style="background-color: #C99E39;">build up</span> a library of tools and a set of tutorials that allows others to learn prompt engineering, as well as work with high value partners to directly solve their challenges.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">Responsibilities: Discover, test, <span style="background-color: #C99E39;">and document best practices for a wide</span> range of tasks relevant to our customers.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;"><span style="background-color: #C99E39;">Build up a library of high quality prompts or prompt chains</span> to <span style="background-color: #C99E39;">accomplish a</span> variety of tasks, with an easy guide to help users search for the one that meets their needs.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;"><span style="background-color: #C99E39;">Build a set of tutorials and interactive tools</span> that teach the art of prompt engineering to our customers.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;"><span style="background-color: #C99E39;">Work with large enterprise customers</span> on their prompting strategies.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">Are an excellent <span style="background-color: #C99E39;">communicator</span>, and love <span style="background-color: #C99E39;">teaching technical concepts</span> and <span style="background-color: #C99E39;">creating high quality documentation</span> that helps out others.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">Are excited to <span style="background-color: #C99E39;">talk to motivated customers</span> and help <span style="background-color: #C99E39;">solve their problems</span>.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">Have a <span style="background-color: #C99E39;">creative hacker spirit</span> and love <span style="background-color: #C99E39;">solving puzzles</span>.<br></div>
</div>
<div class="cell-output cell-output-display">

<div style="background-color: #333333; color: #FFFFFF;">Have at least basic <span style="background-color: #C99E39;">programming</span> skills and would be comfortable writing small Python programs.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">Have an <span style="background-color: #C99E39;">organizational mindset</span> and enjoy <span style="background-color: #C99E39;">building teams from the ground up</span>.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">You <span style="background-color: #C99E39;">think holistically</span> and can <span style="background-color: #C99E39;">proactively identify the needs of an organization</span>.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;"><span style="background-color: #C99E39;">Make ambiguous problems clear</span> and <span style="background-color: #C99E39;">identify core principles</span> that can translate across scenarios.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">Have a passion for <span style="background-color: #C99E39;">making powerful technology safe and societally beneficial</span>.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">You anticipate unforeseen risks, model out scenarios, and <span style="background-color: #C99E39;">provide</span> actionable guidance to internal stakeholders.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;"><span style="background-color: #C99E39;">Think creatively about the risks and benefits of new technologies</span>, and <span style="background-color: #C99E39;">think beyond past checklists</span> and playbooks.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">You stay up-to-date and informed by taking an <span style="background-color: #C99E39;">active</span> interest in emerging research and industry trends.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">As such, we greatly value <span style="background-color: #C99E39;">communication skills</span>.<br></div>
</div>
</div>
<p>We look forward to running more experiments with other GPT-3 models on a range of hyper-parameters and in time GPT-4. We now turn to explore ways in which we can productively prompt OpenAI’s LLMs to extract skills.</p>
</section>
<section id="prompt-design-with-gpt-3.5-and-gpt-4" class="level3">
<h3 class="anchored" data-anchor-id="prompt-design-with-gpt-3.5-and-gpt-4">3. Prompt Design with GPT-3.5 and GPT-4</h3>
<p>Prompt design is an emerging discipline combining programming, instructing, teaching and lots of experimentation. There are infinite ways we could prompt AI to extract skills from text. Within the scope of this experimentation, we explore two approaches:</p>
<ol type="1">
<li><p>Extracting substrings from the original text (similar to the other examples)</p></li>
<li><p>Inferring skills from the original text without the skills needing to match the original content word for word.</p></li>
</ol>
<p>Thanks to OpenAI’s API and python library, we can chain together prompts to guide LLMs to output labelled spans with relative ease. The example prompt chain we want to build is two step:</p>
<ol type="1">
<li><p>identify if a sentence from a job profile mentions any skills</p></li>
<li><p>extract skills from the sentence that mentions skills</p></li>
</ol>
<div class="cell">
<div class="cell-output cell-output-display">
<p><img src="skills_extraction_files/figure-html/cell-20-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p>This prompt chain could be represented in the following <code>label_skills_chain</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> label_skills_chain(sentence: <span class="bu">str</span>, <span class="co"># sentence from job profile </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                 role: <span class="bu">str</span> <span class="co"># role title from job profile</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                ) <span class="op">-&gt;</span> <span class="bu">list</span>:</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Extracts skills from job profiles"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    chat_history <span class="op">=</span> _init_chat_history(sentence, role)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    contains_skills, contains_skills_chat <span class="op">=</span> _does_sentence_contain_skills(chat_history)  </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> contains_skills:</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> []</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    labelled_skills_chat, skills <span class="op">=</span> _annotate_skills(contains_skills_chat, sentence)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> skills</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _init_chat_history(sentence: <span class="bu">str</span>, <span class="co"># sentence from job profile</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>                       role: <span class="bu">str</span> <span class="co"># role title from job profile</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>                      ) <span class="op">-&gt;</span> <span class="bu">list</span>[<span class="bu">dict</span>]:</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Construct initial chat prompt"</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>        {<span class="st">"role"</span>: <span class="st">"system"</span>, <span class="st">"content"</span>: <span class="st">"You are a professional data annotator tasked with labelling skills within random sentences taken from online job advertisements."</span>},</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        {<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: <span class="ss">f"Does the following sentence randomly taken from a job advertisement contain any mention of specific, detailed and relevant skills required for the role of </span><span class="sc">{</span>role<span class="sc">}</span><span class="ss">? Answer only 'yes' or 'no' without providing any justification: sentence='</span><span class="sc">{</span>sentence<span class="sc">}</span><span class="ss">'"</span>}</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _does_sentence_contain_skills(chat_history: <span class="bu">list</span> <span class="co"># list of prompts and responses</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>                                 ) <span class="op">-&gt;</span> Tuple[<span class="bu">bool</span>, List[<span class="bu">dict</span>]]:</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Check if sentence contains any skills"</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> openai.ChatCompletion.create(</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span><span class="st">"gpt-4"</span>,</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        messages<span class="op">=</span>chat_history,</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>        temperature <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    content <span class="op">=</span> response[<span class="st">"choices"</span>][<span class="dv">0</span>][<span class="st">'message'</span>][<span class="st">"content"</span>].lower()</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'yes'</span> <span class="kw">in</span> content <span class="kw">and</span> <span class="st">'no'</span> <span class="kw">not</span> <span class="kw">in</span> content:</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>        chat_history.append({<span class="st">'role'</span>: <span class="st">'assistant'</span>, <span class="st">'content'</span>: <span class="st">'yes.'</span>})</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span>, chat_history</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>        chat_history.append({<span class="st">'role'</span>: <span class="st">'assistant'</span>, <span class="st">'content'</span>: <span class="st">'no.'</span>})</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span>, chat_history</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _annotate_skills(chat_history: <span class="bu">list</span>, <span class="co"># "Construct initial chat prompt"</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>                     sentence: <span class="bu">str</span>) <span class="op">-&gt;</span> Tuple[List, List]:</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Label all skills in sentence returning list of skill spans"</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    annotation_prompt <span class="op">=</span> {</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">"content"</span>: <span class="ss">f"Annotate all of the relevant and job-specific skills in the previous sentence. Please return ONLY a Python list containing the substrings within the sentence that mention skills. Avoid skills that are too generic or vague. Here is a reminder of the sentence: </span><span class="sc">{</span>sentence<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>    chat_history.append(annotation_prompt)</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> _extract_skills_from_response(chat_history)</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _extract_skills_from_response(chat_history: <span class="bu">list</span> <span class="co"># list of prompts and responses</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>                                 ) <span class="op">-&gt;</span> Tuple[List, List]:</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Extract skills from the model's response."</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>    attempt <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>    temperature <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># LLMs hallucinate and return output in myriad formats so we make 3 </span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># attempts to extract list for varying temperatures</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> attempt <span class="op">&lt;</span> <span class="dv">3</span>:</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> openai.ChatCompletion.create(</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>            model<span class="op">=</span><span class="st">"gpt-4"</span>,</span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>            messages<span class="op">=</span>chat_history,</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>            temperature<span class="op">=</span>temperature</span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>            chat_history.append({<span class="st">'role'</span>: <span class="st">'assistant'</span>, <span class="st">'content'</span>: response[<span class="st">'choices'</span>][<span class="dv">0</span>][<span class="st">'message'</span>][<span class="st">"content"</span>]})</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> chat_history, ast.literal_eval(response[<span class="st">'choices'</span>][<span class="dv">0</span>][<span class="st">'message'</span>][<span class="st">"content"</span>])</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">SyntaxError</span>:</span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>            attempt <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>            temperature <span class="op">+=</span> <span class="fl">0.2</span>      </span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [], []</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>label_skills_chain(<span class="st">"You should be able to program in python and cook a mean risotto"</span>, <span class="st">"Prompt Engineer"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['program in python', 'cook a mean risotto']</code></pre>
</div>
</div>
<p>Lets annotate our favourite ‘Prompt Engineer’ job profile once more:</p>
<div class="cell">
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">You will <span style="background-color: #C99E39;">figure out the best methods of prompting our AI</span> to accomplish a wide range of tasks, then <span style="background-color: #C99E39;">document these methods</span> to <span style="background-color: #C99E39;">build up a library of tools</span> and a <span style="background-color: #C99E39;">set of tutorials</span> that allows others to learn prompt engineering, as well as <span style="background-color: #C99E39;">work with high value partners</span> to <span style="background-color: #C99E39;">directly solve their challenges</span>.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">Given that the field of prompt-engineering is arguably less than 2 years old, this position is a bit hard to hire for!  As a result, we ask that you share with us a specific <span style="background-color: #C99E39;">prompt engineering project on LLMs</span> that you’re proud of in your application!  Ideally this project should show off a <span style="background-color: #C99E39;">complex and clever prompting architecture</span> or a <span style="background-color: #C99E39;">systematic evaluation of an LLM’s behavior</span>.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">Our interdisciplinary team has experience across <span style="background-color: #C99E39;">ML</span>, <span style="background-color: #C99E39;">physics</span>, <span style="background-color: #C99E39;">policy</span>, <span style="background-color: #C99E39;">business</span> and <span style="background-color: #C99E39;">product</span>.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;"><span style="background-color: #C99E39;">Build up a library of high quality prompts or prompt chains</span> to <span style="background-color: #C99E39;">accomplish a variety of tasks</span>, with an easy guide to <span style="background-color: #C99E39;">help users search for the one that meets their needs</span>.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;"><span style="background-color: #C99E39;">Build a set of tutorials</span> and <span style="background-color: #C99E39;">interactive tools</span> that <span style="background-color: #C99E39;">teach the art of prompt engineering</span> to our customers.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">Have at least a <span style="background-color: #C99E39;">high level familiarity with the architecture</span> and <span style="background-color: #C99E39;">operation of large language models</span>.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">Are an <span style="background-color: #C99E39;">excellent communicator</span>, and love <span style="background-color: #C99E39;">teaching technical concepts</span> and <span style="background-color: #C99E39;">creating high quality documentation</span> that helps out others.<br></div>
</div>
<div class="cell-output cell-output-display">

<div style="background-color: #333333; color: #FFFFFF;">Have at least <span style="background-color: #C99E39;">basic programming skills</span> and would be comfortable <span style="background-color: #C99E39;">writing small Python programs</span>.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">As such, we greatly value <span style="background-color: #C99E39;">communication skills</span>.<br></div>
</div>
</div>
<p>Of course we can also use LLMs to infer skills that don’t exactly match any substrings in the original text. This is a much more flexible approach and opens up potential for more skills to be identified and a greater level of creativity:</p>
<div class="cell">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">sentence</th>
<th data-quarto-table-cell-role="th">labels</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>You will figure out the best methods of prompting our AI to accomplish a wide range of tasks, then document these methods to build up a library of tools and a set of tutorials that allows others to learn prompt engineering, as well as work with high value partners to directly solve their challenges.</td>
<td>[figuring out best methods of prompting AI, documenting methods, building a library of tools, creating tutorials, working with high value partners, solving challenges]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Given that the field of prompt-engineering is arguably less than 2 years old, this position is a bit hard to hire for! As a result, we ask that you share with us a specific prompt engineering project on LLMs that you’re proud of in your application! Ideally this project should show off a complex and clever prompting architecture or a systematic evaluation of an LLM’s behavior.</td>
<td>[prompt engineering, working with LLMs, developing complex prompting architecture, systematic evaluation of an LLM’s behavior]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Our interdisciplinary team has experience across ML, physics, policy, business and product.</td>
<td>[ML, physics, policy, business, product]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Build up a library of high quality prompts or prompt chains to accomplish a variety of tasks, with an easy guide to help users search for the one that meets their needs.</td>
<td>[Building libraries of prompts, Creating prompt chains, Task accomplishment, Guide creation for user assistance, Understanding user needs]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Build a set of tutorials and interactive tools that teach the art of prompt engineering to our customers.</td>
<td>[Building tutorials, Creating interactive tools, Teaching prompt engineering]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Have at least a high level familiarity with the architecture and operation of large language models.</td>
<td>[high level familiarity with the architecture of large language models, high level familiarity with the operation of large language models]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Are an excellent communicator, and love teaching technical concepts and creating high quality documentation that helps out others.</td>
<td>[excellent communication, teaching technical concepts, creating high quality documentation]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Have at least basic programming skills and would be comfortable writing small Python programs.</td>
<td>[basic programming skills, writing small Python programs]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>You anticipate unforeseen risks, model out scenarios, and provide actionable guidance to internal stakeholders.</td>
<td>[risk anticipation, scenario modelling, providing actionable guidance]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>As such, we greatly value communication skills.</td>
<td>[communication skills]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>This research continues many of the directions our team worked on prior to &lt;ORGANISATION&gt;, including: GPT-3, Circuit-Based Interpretability, Multimodal Neurons, Scaling Laws, AI &amp; Compute, Concrete Problems in AI Safety, and Learning from Human Preferences.</td>
<td>[GPT-3, Circuit-Based Interpretability, Multimodal Neurons, Scaling Laws, AI &amp; Compute, Concrete Problems in AI Safety, Learning from Human Preferences]</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>GPT-4 has managed to synthesize skills from the text and rewrite them as action orientated, often removing determiners and splitting skills. <code>Build a set of tutorials and interactive tools</code> becomes <code>Building tutorials</code> and <code>Creating interactive tools</code>. We can easily recompose this prompt chain adding checking steps to further filter results. It is likely that we will continue to use a combination transformers for tasks like skill extraction leveraging prompt design and fine-tuning.</p>
</section>
<section id="weirdos-and-misfits-bonus-level" class="level3">
<h3 class="anchored" data-anchor-id="weirdos-and-misfits-bonus-level">Weirdos and Misfits Bonus Level 👾👾👾</h3>
<p>We would be remiss if we didn’t test our fine-tuned models and prompt chains on Dominic Cummings’ <a href="https://dominiccummings.com/2020/01/02/two-hands-are-a-lot-were-hiring-data-scientists-project-managers-policy-experts-assorted-weirdos/">vintage job ad</a>.</p>
<p><img src="assets/ten.jpeg" class="img-fluid"></p>
<p>Lets firstly attempt to pass the job profile through Roberta:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> transformers <span class="im">import</span> pipeline</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>token_classifier <span class="op">=</span> pipeline(</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"token-classification"</span>, model<span class="op">=</span><span class="st">"autosyrup/roberta"</span>, tokenizer<span class="op">=</span><span class="st">"autosyrup/roberta"</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    ignore_labels<span class="op">=</span>[<span class="st">'O'</span>]</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>weirdo_roberta_results <span class="op">=</span> run_inference_hf(weirdos, token_classifier)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>display_inference_results(weirdo_roberta_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">Outstanding <span style="background-color: #C99E39;">mathematical skills</span> are essential.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">You should be able to <span style="background-color: #C99E39;">explain to other mathematicians, physicists and computer scientists the ideas</span> in such papers, discuss what could be useful for our projects, <span style="background-color: #C99E39;">synthesise ideas for other data scientists,</span> and apply them to practical problems.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">You will be <span style="background-color: #C99E39;">working with data scientists, designers</span> and others.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">You should a) have an outstanding record at a great university, b) understand conventional economic theories, c) be interested in arguments on the edge of the field — for example, work by physicists on ‘agent-based models’ or by the hedge fund Bridgewater on the failures/limitations of conventional macro theories/prediction, and d) have very strong maths and be interested in <span style="background-color: #C99E39;">working with mathematicians, physicists, and computer scientists</span>.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">The ideal candidate might, for example, have a degree in maths and economics, worked at the LHC in one summer, worked with a quant fund another summer, and <span style="background-color: #C99E39;">written software</span> for a YC startup in a third summer!

We’ve found one of these but want at least one more.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">We want to hire some VERY <span style="background-color: #C99E39;">clever</span> young people either straight out of university or recently out with with extreme <span style="background-color: #C99E39;">curiosity</span> and capacity for hard work.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;"><span style="background-color: #C99E39;">Managing a large organisation</span> involves some general skills.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">Whether it is Coca Cola or Apple, some things are very similar — how to <span style="background-color: #C99E39;">deal with people</span>, how to <span style="background-color: #C99E39;">build great teams</span> and so on.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">If you want to figure out what characters around Putin might do, or how international criminal gangs might exploit holes in our border security, you don’t want more Oxbridge English graduates who chat about Lacan at dinner parties with TV producers and <span style="background-color: #C99E39;">spread fake news about fake news</span>.<br></div>
</div>
<div class="cell-output cell-output-display">
<div style="background-color: #333333; color: #FFFFFF;">It’s important when <span style="background-color: #C99E39;">dealing with large organisations</span> to <span style="background-color: #C99E39;">dart around at different levels</span>, <span style="background-color: #C99E39;">not be stuck with formal hierarchies</span>.<br></div>
</div>
</div>
<p>We notice the model picks up on <code>spread fake news about fake news</code> as the context may not be clear that whilst this is indeed a (useful) skill, it is undesirable in the opinion of the recruiter. Lets now extend our prompt-chain to include an explanation step where will get GPT-4 to attempt an explanation as to why it has or has not labelled a sentence with skills:</p>
<div class="cell">
<div class="cell-output cell-output-display">
<p><img src="skills_extraction_files/figure-html/cell-30-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p>The above prompt chain could be represented as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> label_and_explain_skills_chain(sentence: <span class="bu">str</span>, <span class="co"># sentence from job profile </span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                ) <span class="op">-&gt;</span> Tuple[List, <span class="bu">str</span>]:</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Extracts skills from job profiles"</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    chat_history <span class="op">=</span> _init_chat_history(sentence)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    contains_skills, contains_skills_chat <span class="op">=</span> _does_sentence_contain_skills(chat_history)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    explanation_chat, explanation <span class="op">=</span> _explain_skills(contains_skills_chat)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> contains_skills:</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [], explanation</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    labelled_skills_chat, skills <span class="op">=</span> _annotate_skills(explanation_chat)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> skills, explanation</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _init_chat_history(sentence: <span class="bu">str</span>, <span class="co"># sentence from job profile</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>                      ) <span class="op">-&gt;</span> List[<span class="bu">dict</span>]:</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Construct initial chat prompt"</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>        {<span class="st">"role"</span>: <span class="st">"system"</span>, <span class="st">"content"</span>: <span class="st">"You are a professional data annotator tasked with labelling skills within random sentences taken from online job advertisements."</span>},</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        {<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: <span class="ss">f"Does the following sentence randomly taken from a job advertisement contain any mention of specific, detailed and relevant skills required for a job role? Answer only 'yes' or 'no' without providing any justification: sentence='</span><span class="sc">{</span>sentence<span class="sc">}</span><span class="ss">'"</span>}</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _explain_skills(chat_history: <span class="bu">list</span> <span class="co"># "Construct initial chat prompt"</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>                   ) <span class="op">-&gt;</span> Tuple[List[<span class="bu">dict</span>], <span class="bu">str</span>]:</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Force model to explain its labelling decisions"</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    explanation_prompt <span class="op">=</span> {</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">"content"</span>: <span class="st">"Please explain why you identified or did not identify relevant job skills in this sentence."</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    chat_history.append(explanation_prompt)</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> openai.ChatCompletion.create(</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span><span class="st">"gpt-4"</span>,</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>        messages<span class="op">=</span>chat_history,</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>        temperature <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    explanation <span class="op">=</span> response[<span class="st">"choices"</span>][<span class="dv">0</span>][<span class="st">'message'</span>][<span class="st">"content"</span>]</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    chat_history.append({<span class="st">"role"</span>: <span class="st">"assistant"</span>, <span class="st">"content"</span>: explanation})</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> chat_history, explanation</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _annotate_skills(chat_history: <span class="bu">list</span>, <span class="co"># "Construct initial chat prompt"</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>                    ):</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Label all skills in sentence returning list of skill spans"</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>    annotation_prompt <span class="op">=</span> {</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">"content"</span>: <span class="ss">f"Please return ONLY a Python list containing the unique skill requirements for a job role that you can infer from this sentence. Only include skills that could be unique, descriptive and essential for a job role. If in doubt, do not include the skill."</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>    chat_history.append(annotation_prompt)</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> _extract_skills_from_response(chat_history)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For brevity we only run inference on the first ~10 sentences. We hope this demonstrates how simple it is to add additional steps for explainability or checking to an existing prompt chain:</p>
<div class="cell">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">sentence</th>
<th data-quarto-table-cell-role="th">labels</th>
<th data-quarto-table-cell-role="th">explanation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>There are many brilliant people in the civil service and politics.</td>
<td>[]</td>
<td>The sentence does not mention any specific, detailed, or relevant skills required for a job role. It only makes a general statement about the people in the civil service and politics, without specifying any particular skills or abilities they might have.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Over the past five months the No10 political team has been lucky to work with some fantastic officials.</td>
<td>[]</td>
<td>The sentence does not mention any specific, detailed, or relevant skills required for a job role. It only talks about the experience of the No10 political team working with some officials, but it does not specify what skills are needed or were used.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>But there are also some profound problems at the core of how the British state makes decisions.</td>
<td>[]</td>
<td>The sentence does not mention any specific, detailed, or relevant skills required for a job role. It is a general statement about decision-making in the British state, but does not specify any particular skills or abilities that a job candidate should possess.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>This was seen by pundit-world as a very eccentric view in 2014.</td>
<td>[]</td>
<td>The sentence "This was seen by pundit-world as a very eccentric view in 2014." does not mention any specific, detailed, or relevant skills required for a job role. It seems to be a statement about a viewpoint or opinion, rather than a description of job skills or qualifications.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>It is no longer seen as eccentric.</td>
<td>[]</td>
<td>The sentence "It is no longer seen as eccentric." does not mention any specific, detailed, or relevant skills required for a job role. It is a general statement and does not provide any information about job requirements or qualifications.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Dealing with these deep problems is supported by many great officials, particularly younger ones, though of course there will naturally be many fears — some reasonable, most unreasonable.</td>
<td>[]</td>
<td>The sentence does not mention any specific, detailed, or relevant skills required for a job role. It talks about dealing with problems and mentions officials, but it does not specify what skills are needed to deal with these problems or to be an official.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Now there is a confluence of: a) Brexit requires many large changes in policy and in the structure of decision-making, b) some people in government are prepared to take risks to change things a lot, and c) a new government with a significant majority and little need to worry about short-term unpopularity while trying to make rapid progress with long-term problems.</td>
<td>[]</td>
<td>The sentence does not identify any relevant job skills because it is discussing political and governmental circumstances, not specifying any particular skills or abilities needed for a job role.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>There is a huge amount of low hanging fruit — trillion dollar bills lying on the street — in the intersection of:\n\nthe selection, education and training of people for high performance\nthe frontiers of the science of prediction\ndata science, AI and cognitive technologies (e.g Seeing Rooms, ‘authoring tools designed for arguing from evidence’, Tetlock/IARPA prediction tournaments that could easily be extended to consider ‘clusters’ of issues around themes like Brexit to improve policy and project management)\ncommunication (e.g Cialdini)\ndecision-making institutions at the apex of government.</td>
<td>[education and training for high performance, knowledge in the science of prediction, data science, AI and cognitive technologies, communication skills, experience with decision-making institutions at the apex of government]</td>
<td>The sentence mentions several relevant job skills such as education and training for high performance, knowledge in the science of prediction, data science, AI and cognitive technologies, communication skills, and experience with decision-making institutions at the apex of government.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>We want to hire an unusual set of people with different skills and backgrounds to work in Downing Street with the best officials, some as spads and perhaps some as officials.</td>
<td>[]</td>
<td>The sentence mentions the need for "different skills and backgrounds", which implies that the job requires a diverse set of skills. However, it does not specify what these skills are.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>If you are already an official and you read this blog and think you fit one of these categories, get in touch.</td>
<td>[]</td>
<td>The sentence does not mention any specific, detailed, or relevant skills required for a job role. It only suggests that the reader should get in touch if they believe they fit into a certain category, but it does not specify what that category is or what skills it might require.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>The categories are roughly:\n\nData scientists and software developers\nEconomists\nPolicy experts\nProject managers\nCommunication experts\nJunior researchers one of whom will also be my personal assistant\nWeirdos and misfits with odd skills\nWe want to improve performance and make me much less important — and within a year largely redundant.</td>
<td>[data analysis, coding, economic analysis, policy analysis, project coordination, project management, effective communication, public relations, research, data collection]</td>
<td>The sentence mentions several job roles that inherently require specific skills. For instance, data scientists and software developers need skills in data analysis and coding, economists need skills in economic analysis, policy experts need skills in policy analysis and development, project managers need skills in project coordination and management, communication experts need skills in effective communication and public relations, and junior researchers need skills in research and data collection.</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center"><div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>